define(["require","exports","modules/clean/previews/constants","modules/clean/react/file_viewer/file_viewer_interface_controller","modules/clean/activity/constants","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/convert_annotation_coordinates","modules/clean/react/file_viewer/utils","modules/clean/react/comments2/data/sidebar_watcher"],function(t,n,e,o,i,a,s,r,c){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var d=(function(){function t(t){var n=this;this.dispatch=t,this.mostRecentlySyncedAnnotations=[],this.justPlacedDefaultAnnotation=!1,this.sendAnnotationsToSync=function(){n.interfaceController.dispatchEvent("update-annotations",{annotations:n.mostRecentlySyncedAnnotations})},this.onAnnotationPlaced=function(t){n.updatePendingAnnotation(t.annotation),n.dispatch(a.Actions.requestEditorFocus()),n.justPlacedDefaultAnnotation&&(n.justPlacedDefaultAnnotation=!1)},this.onAnnotationStartDrag=function(t){},this.onAnnotationEndDrag=function(t){n.updatePendingAnnotation(t.annotation),n.dispatch(a.Actions.logEvent("annotation_adjusted"))},this.onAnnotationEnter=function(t){var e=t.commentActivity,o=e&&e.activity_key;n.dispatch(a.Actions.hoverThread(o))},this.onAnnotationLeave=function(t){n.dispatch(a.Actions.hoverThread(void 0))},this.onAnnotationClick=function(t){n.dispatch(a.Actions.activateNextThread(t.rankedActivityKeys))},this.onCommentsVisible=function(){n.dispatch(a.Actions.trackSidebarCommentsVisibility(!0))},this.onCommentsHidden=function(){n.dispatch(a.Actions.trackSidebarCommentsVisibility(!1))},this.docMetadataLoad=function(t){var e=t.metadata;n.dispatch(a.Actions.docMetadataLoad(e))},this.onCurrentPageUpdate=function(t){var e=t.current_page;n.dispatch(a.Actions.updateDocumentCurrentPage(e))},this.eventListenerMap={"annotation-placed":this.onAnnotationPlaced,"annotation-start-drag":this.onAnnotationStartDrag,"annotation-end-drag":this.onAnnotationEndDrag,"annotation-ui-click":this.onAnnotationClick,"annotation-ui-enter":this.onAnnotationEnter,"annotation-ui-leave":this.onAnnotationLeave,"doc-metadata-load":this.docMetadataLoad,"page-rendered":this.sendAnnotationsToSync,"page-change":this.onCurrentPageUpdate},this.sideChannelListenerMap=(e={},e[c.COMMENTS_VISIBLE_SIGNAL]=this.onCommentsVisible,e[c.COMMENTS_HIDDEN_SIGNAL]=this.onCommentsHidden,e);var e}return t.prototype.handleMount=function(t){this.interfaceController=new o.FileViewerInterfaceController(r.getFileViewerInterfaceType(i.ActivityContext.BROWSE_FILE_VIEWER,t));for(var n in this.eventListenerMap)this.interfaceController.addListener(n,this.eventListenerMap[n]);for(var n in this.sideChannelListenerMap)c.sideChannelEventEmitter.addListener(n,this.sideChannelListenerMap[n]);this.mostRecentlySyncedAnnotations=[],this.interfaceController.dispatchEvent("enable-annotation-creation"),this.interfaceController.dispatchEvent("enable-region-creation"),this.interfaceController.dispatchEvent("request-doc-metadata"),t===e.PreviewType.Doc&&this.dispatch(a.Actions.updateDocumentCurrentPage(1))},t.prototype.handleUnmount=function(){for(var t in this.eventListenerMap)this.interfaceController.removeListener(t,this.eventListenerMap[t]);for(var t in this.sideChannelListenerMap)c.sideChannelEventEmitter.removeListener(t,this.sideChannelListenerMap[t]);this.interfaceController.dispatchEvent("disable-annotation-creation"),this.interfaceController.dispatchEvent("disable-region-creation")},t.prototype.updatePreviewType=function(t){this.handleUnmount(),this.handleMount(t)},t.prototype.focusAnnotation=function(t,n){this.interfaceController.dispatchEvent("focus-annotation",{id:t})},t.prototype.hoverAnnotation=function(t){this.interfaceController.dispatchEvent("hover-annotation",{id:t})},t.prototype.syncPdfAnnotations=function(t,n){return this.syncAnnotations(t,function(t){return s.fromComments2ToPdfFileViewAnnotations(t,n)})},t.prototype.syncImageAnnotations=function(t){return this.syncAnnotations(t,s.fromComments2ToImageFileViewAnnotations)},t.prototype.syncAnnotations=function(t,n){this.mostRecentlySyncedAnnotations=t.map(function(t){var e=t.annotation,o=void 0!==e.label?e.label:-1;return{annotation:n(e),commentActivity:{activity_key:t.id},options:{isGhostAnnotation:!1,isAnnotationNumberingEnabled:o!==-1,annotationNumber:o}}}),this.sendAnnotationsToSync()},t.prototype.addAnnotationHiddenListener=function(t){this.interfaceController.addListener("annotation-hidden",t)},t.prototype.removeAnnotationHiddenListener=function(t){this.interfaceController.removeListener("annotation-hidden",t)},t.prototype.placeDefaultAnnotation=function(){this.justPlacedDefaultAnnotation=!0,this.interfaceController.dispatchEvent("place-default-annotation")},t.prototype.scrollToAnnotation=function(t,n){this.interfaceController.dispatchEvent("scroll-to-annotation",{page:t,commentActivity:{activity_key:n}})},t.prototype.clearSelection=function(t){var n=this,e=n.dispatch;n.interfaceController.dispatchEvent("hide-annotation"),e(a.Actions.clearPendingNumberedAnnotation()),t&&e(a.Actions.logEvent("annotation_cancelled"))},t.prototype.updatePendingAnnotation=function(t){var n=s.fromFileViewToComments2Annotation(t);this.dispatch(a.Actions.setPendingNumberedAnnotation(n)),"document"===n.type&&this.interfaceController.dispatchEvent("hide-annotation",{excludePage:n.regions[0].page})},t})();n.FrameMessageListener=d});
//# sourceMappingURL=frame_message_listener.min.js-vflN6LNDy.map